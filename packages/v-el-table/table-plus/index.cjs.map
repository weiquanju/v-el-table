{"version":3,"file":"index.cjs","sources":["../../../app/v-el-table-source/src/components/table-plus/config.ts","../../../app/v-el-table-source/src/components/table-plus/default-layout.ts","../../../app/v-el-table-source/src/components/table-plus/default-button.ts","../../../app/v-el-table-source/src/components/table-plus/index.ts"],"sourcesContent":["// 存放默认配置常量\r\n\r\nexport const paginationDefault = {\r\n  currentPage: 1,\r\n  pageSizes: [10, 20, 30, 40, 50],\r\n  pageSize: 10,\r\n  layout: 'total, sizes, prev, pager, next, jumper',\r\n  total: 0,\r\n}\r\n// 分页参数存放路径配置\r\nexport const dataPath = {\r\n  data: 'data',\r\n  currentPage: 'page',\r\n  total: 'total',\r\n}","import { h, nextTick, ref, type SetupContext } from 'vue'\r\nimport style from './default-layout.module.css'\r\nimport './default-layout.css'\r\nexport const LayoutDefault = (props: never, { slots }: SetupContext) => {\r\n  nextTick(() => {\r\n    init()\r\n  })\r\n  const box = ref(null as null | HTMLDivElement)\r\n\r\n  const init = () => {\r\n    if (!box.value?.offsetWidth) {\r\n      return\r\n    }\r\n\r\n    const resize = () => {\r\n      if (!box.value) return\r\n      const { style } = box.value\r\n      const columnNum = Math.floor(box.value?.offsetWidth / 300)\r\n      style.setProperty('--tp-column-num', columnNum.toString())\r\n    }\r\n\r\n    const resizeObserver = new ResizeObserver(resize)\r\n    resizeObserver.observe(box.value)\r\n  }\r\n\r\n  return h('div', { class: [style.tp, 'v-el-table'] }, [\r\n    h('div', { class: [style.tpHeader, 'v-el-table-header'] }, [\r\n      h('div', { class: [style.tpTitle, 'v-el-table-title'] }, [slots.title && slots.title()]),\r\n      h('div', { class: [style.tpBtn, 'v-el-table-button'] }, [slots.btn && slots.btn()]),\r\n    ]),\r\n    h('div', { class: ['tp_filter_x001', 'v-el-table-filter'], ref: box }, [slots.filter && slots.filter()]),\r\n    h('div', { class: [style.tpTable, 'v-el-table-main'] }, [slots.table && slots.table()]),\r\n    h('div', { class: [style.tpPagination, 'v-el-table-pagination'] }, [slots.pagination && slots.pagination()]),\r\n  ])\r\n}\r\n","import * as ElementIcons from '@element-plus/icons-vue'\r\nimport type { TablePlusProps } from './type'\r\nimport { resetValue, eventsTransform } from '../utils'\r\nimport { ElButton } from 'element-plus'\r\nimport { h, isRef } from 'vue'\r\nimport { i18n } from '../utils'\r\nimport type { ButtonConfig } from './default-button-type'\r\n\r\nconst createButton = ({ name, icon, events = {}, buttonProps = {} }: ButtonConfig) =>\r\n  h(\r\n    ElButton,\r\n    { ...eventsTransform(events), ...buttonProps },\r\n    {\r\n      icon: () => h(ElementIcons[icon]),\r\n      default: () => (isRef(name) ? name.value : name),\r\n    },\r\n  )\r\n\r\n/**@todo 定义按钮组件 */\r\nexport const getDefaultButtons = ({ props, query }: { props: TablePlusProps; query: () => void }) => {\r\n  const defaultButton: ButtonConfig[] = [\r\n    {\r\n      key: 'query',\r\n      name: i18n.t('query'),\r\n      icon: 'Search',\r\n      events: {\r\n        click: query,\r\n      },\r\n    },\r\n    {\r\n      key: 'reset',\r\n      name: i18n.t('reset'),\r\n      icon: 'CircleClose',\r\n      events: { click: () => resetValue(props.formProps.form.model) },\r\n    },\r\n  ]\r\n\r\n  return [...defaultButton, ...(props.buttons || [])].map((button) => {\r\n    if (Array.isArray(button)) {\r\n      const [component, ...params] = button\r\n      return h(component, ...params)\r\n    }\r\n    return createButton(button as ButtonConfig)\r\n  })\r\n}\r\n","import { h, reactive, type FunctionalComponent } from 'vue'\r\nimport { ElPagination, ElButtonGroup } from 'element-plus'\r\nimport Form from '../form'\r\nimport Table from '../table'\r\nimport type { TablePlusProps } from './type'\r\nimport { at, toCamelCaseProp } from '../utils'\r\nimport { dataPath, paginationDefault } from './config'\r\nimport { LayoutDefault } from './default-layout'\r\nimport { getDefaultButtons } from './default-button'\r\nexport type * from './type'\r\nexport * from './config'\r\nexport * from './default-button'\r\nexport * from './default-layout'\r\n\r\n/**\r\n * @todo feat:\r\n * 支持单元格编辑\r\n * 支持CURD\r\n * 组件插槽支持\r\n */\r\nconst VElTablePlus: FunctionalComponent<TablePlusProps> = function (p: TablePlusProps) {\r\n  // console.log(Object.keys(props))\r\n  const props = toCamelCaseProp(p as unknown as Parameters<typeof toCamelCaseProp>[0]) as unknown as TablePlusProps\r\n\r\n  const getQueryParams = () => ({\r\n    pageSize: pagination.pageSize,\r\n    currentPage: pagination.currentPage,\r\n    ...props.formProps.form.model,\r\n    ...(props.queryParams || {}),\r\n  })\r\n\r\n  const query = async () => {\r\n    // 文件路径配置\r\n    const path = Object.assign({}, dataPath, props.responsePath)\r\n\r\n    const data = await props.query(getQueryParams())\r\n    const res = at<unknown[]>(path.data, data) || []\r\n    const total = at<number>(path.total, data) || 0\r\n    const currentPage = at<number>(path.currentPage, data) || 1\r\n\r\n    if (total === undefined || isNaN(total)) {\r\n      console.warn(`merged path data`, JSON.stringify(path))\r\n      throw new Error('Get `total` param error when query data.Please check VElTablePlus configuration parameter `responsePath`.')\r\n    }\r\n    if (currentPage === undefined || isNaN(currentPage)) {\r\n      console.warn(`merged path data`, JSON.stringify(path))\r\n      throw new Error('Get `currentPage` param error when query data.Please check VElTablePlus configuration parameter `responsePath`.')\r\n    }\r\n    if (res === undefined) {\r\n      console.warn(`merged path data`, JSON.stringify(path))\r\n      throw new Error('Get `data` param error when query data.Please check VElTablePlus configuration parameter `responsePath`.')\r\n    }\r\n\r\n    props.tableProps.table.data = res\r\n    pagination.total = total\r\n    pagination.currentPage = currentPage\r\n  }\r\n\r\n  const pagination = reactive(\r\n    Object.assign(paginationDefault, props.pagination, {\r\n      onSizeChange(size: number) {\r\n        if (pagination.pageSize !== size) {\r\n          pagination.pageSize = size\r\n          query()\r\n        }\r\n      },\r\n      'onUpdate:page-size'(size: number) {\r\n        if (pagination.pageSize !== size) {\r\n          pagination.pageSize = size\r\n          query()\r\n        }\r\n      },\r\n      onCurrentChange(page: number) {\r\n        if (pagination.currentPage !== page) {\r\n          pagination.currentPage = page\r\n          query()\r\n        }\r\n      },\r\n      'onUpdate:current-page'(page: number) {\r\n        if (pagination.currentPage !== page) {\r\n          pagination.currentPage = page\r\n          query()\r\n        }\r\n      },\r\n    }),\r\n  )\r\n\r\n  const slots = {\r\n    title: () => props.title,\r\n    btn: () => h(ElButtonGroup, null, { default: () => getDefaultButtons({ props, query }) }), //查询 重置 查询配置 表格配置 表格导出 收起/展开 新增 编辑 删除\r\n    filter: () => h(Form, props.formProps),\r\n    table: () => h(Table, props.tableProps),\r\n    pagination: () => h(ElPagination, pagination),\r\n  }\r\n\r\n  if (props.initQuery === true) {\r\n    query()\r\n  }\r\n\r\n  return h(props.layout || LayoutDefault, props.layoutProps, slots)\r\n}\r\nexport default VElTablePlus\r\n"],"names":["paginationDefault","dataPath","LayoutDefault","props","slots","nextTick","init","box","ref","_a","resize","style","columnNum","h","createButton","name","icon","events","buttonProps","ElButton","eventsTransform","ElementIcons","isRef","getDefaultButtons","query","i18n","resetValue","button","component","params","VElTablePlus","p","toCamelCaseProp","getQueryParams","pagination","path","data","res","at","total","currentPage","reactive","size","page","ElButtonGroup","Form","Table","ElPagination"],"mappings":"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"}