{"version":3,"file":"index.mjs","sources":["../../../app/v-el-table-source/src/components/table-plus/config.ts","../../../app/v-el-table-source/src/components/table-plus/default-layout.ts","../../../app/v-el-table-source/src/components/table-plus/default-button.ts","../../../app/v-el-table-source/src/components/table-plus/index.ts"],"sourcesContent":["// 存放默认配置常量\r\n\r\nexport const paginationDefault = {\r\n  currentPage: 1,\r\n  pageSizes: [10, 20, 30, 40, 50],\r\n  pageSize: 10,\r\n  layout: 'total, sizes, prev, pager, next, jumper',\r\n  total: 0,\r\n}\r\n// 分页参数存放路径配置\r\nexport const dataPath = {\r\n  data: 'data',\r\n  currentPage: 'page',\r\n  total: 'total',\r\n}","import { h, nextTick, ref, type SetupContext } from 'vue'\r\nimport style from './default-layout.module.css'\r\nimport './default-layout.css'\r\nexport const LayoutDefault = (props: never, { slots }: SetupContext) => {\r\n  nextTick(() => {\r\n    init()\r\n  })\r\n  const box = ref(null as null | HTMLDivElement)\r\n\r\n  const init = () => {\r\n    if (!box.value?.offsetWidth) {\r\n      return\r\n    }\r\n\r\n    const resize = () => {\r\n      if (!box.value) return\r\n      const { style } = box.value\r\n      const columnNum = Math.floor(box.value?.offsetWidth / 300)\r\n      style.setProperty('--tp-column-num', columnNum.toString())\r\n    }\r\n\r\n    const resizeObserver = new ResizeObserver(resize)\r\n    resizeObserver.observe(box.value)\r\n  }\r\n\r\n  return h('div', { class: [style.tp, 'v-el-table'] }, [\r\n    h('div', { class: [style.tpHeader, 'v-el-table-header'] }, [\r\n      h('div', { class: [style.tpTitle, 'v-el-table-title'] }, [slots.title && slots.title()]),\r\n      h('div', { class: [style.tpBtn, 'v-el-table-button'] }, [slots.btn && slots.btn()]),\r\n    ]),\r\n    h('div', { class: ['tp_filter_x001', 'v-el-table-filter'], ref: box }, [slots.filter && slots.filter()]),\r\n    h('div', { class: [style.tpTable, 'v-el-table-main'] }, [slots.table && slots.table()]),\r\n    h('div', { class: [style.tpPagination, 'v-el-table-pagination'] }, [slots.pagination && slots.pagination()]),\r\n  ])\r\n}\r\n","import * as ElementIcons from '@element-plus/icons-vue'\r\nimport type { TablePlusProps } from './type'\r\nimport { resetValue, eventsTransform } from '../utils'\r\nimport { ElButton } from 'element-plus'\r\nimport { h, isRef } from 'vue'\r\nimport { i18n } from '../utils'\r\nimport type { ButtonConfig } from './default-button-type'\r\n\r\nconst createButton = ({ name, icon, events = {}, buttonProps = {} }: ButtonConfig) =>\r\n  h(\r\n    ElButton,\r\n    { ...eventsTransform(events), ...buttonProps },\r\n    {\r\n      icon: () => h(ElementIcons[icon]),\r\n      default: () => (isRef(name) ? name.value : name),\r\n    },\r\n  )\r\n\r\n/**@todo 定义按钮组件 */\r\nexport const getDefaultButtons = ({ props, query }: { props: TablePlusProps; query: () => void }) => {\r\n  const defaultButton: ButtonConfig[] = [\r\n    {\r\n      key: 'query',\r\n      name: i18n.t('query'),\r\n      icon: 'Search',\r\n      events: {\r\n        click: query,\r\n      },\r\n    },\r\n    {\r\n      key: 'reset',\r\n      name: i18n.t('reset'),\r\n      icon: 'CircleClose',\r\n      events: { click: () => resetValue(props.formProps.form.model) },\r\n    },\r\n  ]\r\n\r\n  return [...defaultButton, ...(props.buttons || [])].map((button) => {\r\n    if (Array.isArray(button)) {\r\n      const [component, ...params] = button\r\n      return h(component, ...params)\r\n    }\r\n    return createButton(button as ButtonConfig)\r\n  })\r\n}\r\n","import { h, reactive, type FunctionalComponent } from 'vue'\r\nimport { ElPagination, ElButtonGroup } from 'element-plus'\r\nimport Form from '../form'\r\nimport Table from '../table'\r\nimport type { TablePlusProps } from './type'\r\nimport { at, toCamelCaseProp } from '../utils'\r\nimport { dataPath, paginationDefault } from './config'\r\nimport { LayoutDefault } from './default-layout'\r\nimport { getDefaultButtons } from './default-button'\r\n\r\n/**\r\n * @todo feat:\r\n * 支持单元格编辑\r\n * 支持CURD\r\n * 组件插槽支持\r\n */\r\nconst VElTablePlus: FunctionalComponent<TablePlusProps> = function (p: TablePlusProps) {\r\n  // console.log(Object.keys(props))\r\n  const props = toCamelCaseProp(p as unknown as Parameters<typeof toCamelCaseProp>[0]) as unknown as TablePlusProps\r\n\r\n  const getQueryParams = () => ({\r\n    pageSize: pagination.pageSize,\r\n    currentPage: pagination.currentPage,\r\n    ...props.formProps.form.model,\r\n    ...(props.queryParams || {}),\r\n  })\r\n\r\n  const query = async () => {\r\n    // 文件路径配置\r\n    const path = Object.assign({}, dataPath, props.responsePath)\r\n\r\n    const data = await props.query(getQueryParams())\r\n    const res = at<unknown[]>(path.data, data) || []\r\n    const total = at<number>(path.total, data) || 0\r\n    const currentPage = at<number>(path.currentPage, data) || 1\r\n\r\n    if (total === undefined || isNaN(total)) {\r\n      console.warn(`merged path data`, JSON.stringify(path))\r\n      throw new Error('Get `total` param error when query data.Please check VElTablePlus configuration parameter `responsePath`.')\r\n    }\r\n    if (currentPage === undefined || isNaN(currentPage)) {\r\n      console.warn(`merged path data`, JSON.stringify(path))\r\n      throw new Error('Get `currentPage` param error when query data.Please check VElTablePlus configuration parameter `responsePath`.')\r\n    }\r\n    if (res === undefined) {\r\n      console.warn(`merged path data`, JSON.stringify(path))\r\n      throw new Error('Get `data` param error when query data.Please check VElTablePlus configuration parameter `responsePath`.')\r\n    }\r\n\r\n    props.tableProps.table.data = res\r\n    pagination.total = total\r\n    pagination.currentPage = currentPage\r\n  }\r\n\r\n  const pagination = reactive(\r\n    Object.assign(paginationDefault, props.pagination, {\r\n      onSizeChange(size: number) {\r\n        if (pagination.pageSize !== size) {\r\n          pagination.pageSize = size\r\n          query()\r\n        }\r\n      },\r\n      'onUpdate:page-size'(size: number) {\r\n        if (pagination.pageSize !== size) {\r\n          pagination.pageSize = size\r\n          query()\r\n        }\r\n      },\r\n      onCurrentChange(page: number) {\r\n        if (pagination.currentPage !== page) {\r\n          pagination.currentPage = page\r\n          query()\r\n        }\r\n      },\r\n      'onUpdate:current-page'(page: number) {\r\n        if (pagination.currentPage !== page) {\r\n          pagination.currentPage = page\r\n          query()\r\n        }\r\n      },\r\n    }),\r\n  )\r\n\r\n  const slots = {\r\n    title: () => props.title,\r\n    btn: () => h(ElButtonGroup, null, { default: () => getDefaultButtons({ props, query }) }), //查询 重置 查询配置 表格配置 表格导出 收起/展开 新增 编辑 删除\r\n    filter: () => h(Form, props.formProps),\r\n    table: () => h(Table, props.tableProps),\r\n    pagination: () => h(ElPagination, pagination),\r\n  }\r\n\r\n  if (props.initQuery === true) {\r\n    query()\r\n  }\r\n\r\n  return h(props.layout || LayoutDefault, props.layoutProps, slots)\r\n}\r\nexport default VElTablePlus\r\n"],"names":["paginationDefault","dataPath","LayoutDefault","props","slots","nextTick","init","box","ref","_a","resize","style","columnNum","h","createButton","name","icon","events","buttonProps","ElButton","eventsTransform","ElementIcons","isRef","getDefaultButtons","query","i18n","resetValue","button","component","params","VElTablePlus","p","toCamelCaseProp","getQueryParams","pagination","path","data","res","at","total","currentPage","reactive","size","page","ElButtonGroup","Form","Table","ElPagination"],"mappings":"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"}